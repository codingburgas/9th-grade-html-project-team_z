<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Център за съобщения - Пожарна Безопасност</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1 class="logo"><i class="fa-solid fa-fire-extinguisher"></i> Пожарна Безопасност</h1>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html" data-section="home"><i class="fa-solid fa-house"></i> Начало</a></li>
                    <li><a href="employees.html" data-section="employees"><i class="fa-solid fa-users"></i> Служители</a></li>
                    <li><a href="vehicles.html" data-section="vehicles"><i class="fa-solid fa-truck-fire"></i> Автомобили</a></li>
                    <li><a href="report-incident.html" data-section="report-incident"><i class="fa-solid fa-triangle-exclamation"></i> Докладвай</a></li>
                    <li><a href="incidents.html" data-section="incidents"><i class="fa-solid fa-list-check"></i> Произшествия</a></li>
                    <li><a href="statistics.html" data-section="statistics"><i class="fa-solid fa-chart-line"></i> Статистика</a></li>
                    <li><a href="map.html" data-section="map-section"><i class="fa-solid fa-map-location-dot"></i> Карта</a></li>
                    <li><a href="messages.html" class="active" data-section="messages"><i class="fa-solid fa-envelope"></i> Съобщения</a></li>
                </ul>
            </nav>
            <button id="theme-toggle" class="icon-button"><i class="fa-solid fa-moon"></i></button>
        </div>
    </header>
    <main class="content-area">
        <section id="messages" class="active">
            <div class="section-header">
                <h2><i class="fa-solid fa-envelope"></i> Център за съобщения</h2>
            </div>
            <div class="messages-layout">
                <div class="message-form-container card">
                    <h3>Изпрати ново съобщение</h3>
                    <form id="message-form" class="complex-form">
                        <div class="form-group">
                            <label for="message-recipient"><i class="fa-solid fa-user"></i> Получател:</label>
                            <select id="message-recipient" name="message-recipient" required>
                                <option value="all">Всички служители</option>
                                </select>
                        </div>
                        <div class="form-group">
                            <label for="message-template"><i class="fa-solid fa-note-sticky"></i> Избери шаблон:</label>
                            <select id="message-template" name="message-template">
                                <option value="">Без шаблон</option>
                                <option value="Спешно: Моля, прегледайте новите произшествия.">Спешно: Моля, прегледайте новите произшествия.</option>
                                <option value="Напомняне: Приключете текущите задачи.">Напомняне: Приключете текущите задачи.</option>
                                <option value="Информация: Екипите са в готовност.">Информация: Екипите са в готовност.</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message-text"><i class="fa-solid fa-comment-dots"></i> Съобщение:</label>
                            <textarea id="message-text" name="message-text" rows="5" required placeholder="Въведете вашето съобщение тук..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-submit"><i class="fa-solid fa-paper-plane"></i> Изпрати съобщение</button>
                        <div id="message-status" class="message"></div>
                    </form>
                </div>

                <div class="message-inbox card">
                    <h3><i class="fa-solid fa-inbox"></i> Входящи съобщения</h3>
                    <ul id="inbox-list">
                        <li class="inbox-item new">
                            <span class="sender">Админ</span>
                            <span class="timestamp">05.06.2025, 10:30</span>
                            <p>Спешно: Моля, прегледайте новите произшествия.</p>
                            <button class="read-btn"><i class="fa-solid fa-eye"></i> Прочетено</button>
                        </li>
                        <li class="inbox-item">
                            <span class="sender">Екип Alpha</span>
                            <span class="timestamp">04.06.2025, 15:45</span>
                            <p>Произшествие приключено успешно.</p>
                            <button class="read-btn"><i class="fa-solid fa-eye"></i> Прочетено</button>
                        </li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Информационна система за Пожарна Безопасност</p>
    </footer>
    <script src="script.js"></script>
    <script>
        // Specific script for messages.html
        document.addEventListener('DOMContentLoaded', () => {
            let employees = [
                { id: 1, firstName: 'Иван', lastName: 'Петров', EGN: '8012051234', team: 'Alpha', status: 'available' },
                { id: 2, firstName: 'Мария', lastName: 'Георгиева', EGN: '9203105678', team: 'Beta', status: 'in-incident' },
                { id: 3, firstName: 'Георги', lastName: 'Иванов', EGN: '7507159876', team: 'Alpha', status: 'available' },
                { id: 4, firstName: 'Елена', lastName: 'Димитрова', EGN: '8801201122', team: 'Gamma', status: 'on-leave' },
                { id: 5, firstName: 'Петър', lastName: 'Колев', EGN: '9504253344', team: 'Beta', status: 'available' },
                { id: 6, firstName: 'Николай', lastName: 'Стоянов', EGN: '8309015566', team: 'Gamma', status: 'in-incident' },
            ];

            const messageRecipientSelect = document.getElementById('message-recipient');

            const populateRecipientSelect = () => {
                if (messageRecipientSelect) {
                    messageRecipientSelect.innerHTML = '<option value="all">Всички служители</option>';
                    employees.forEach(emp => {
                        const option = document.createElement('option');
                        option.value = emp.id;
                        option.textContent = `${emp.firstName} ${emp.lastName} (${emp.team})`;
                        messageRecipientSelect.appendChild(option);
                    });
                }
            };
            populateRecipientSelect();

            const messageForm = document.getElementById('message-form');
            const messageStatusDiv = document.getElementById('message-status');

            if (messageForm) {
                messageForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(messageForm);
                    const recipient = formData.get('message-recipient');
                    const messageText = formData.get('message-text');

                    console.log(`Sending message to ${recipient}: "${messageText}"`);

                    messageStatusDiv.textContent = `Съобщението е изпратено до ${recipient === 'all' ? 'всички служители' : 'служител ' + employees.find(e => e.id == recipient)?.firstName || 'Неизвестен'}!`;
                    messageStatusDiv.classList.remove('error');
                    messageStatusDiv.classList.add('success');
                    messageStatusDiv.style.display = 'block';
                    messageForm.reset();

                    setTimeout(() => {
                        messageStatusDiv.style.display = 'none';
                    }, 3000);

                    const inboxList = document.getElementById('inbox-list');
                    if (inboxList) {
                        const newMessageItem = document.createElement('li');
                        newMessageItem.classList.add('inbox-item', 'new');
                        newMessageItem.innerHTML = `
                            <span class="sender">Вие (До ${recipient === 'all' ? 'Всички' : employees.find(e => e.id == recipient)?.firstName || 'Неизвестен'})</span>
                            <span class="timestamp">${new Date().toLocaleString('bg-BG')}</span>
                            <p>${messageText}</p>
                            <button class="read-btn"><i class="fa-solid fa-eye"></i> Прочетено</button>
                        `;
                        inboxList.prepend(newMessageItem);
                    }
                });
            }

            document.getElementById('messages')?.addEventListener('click', (e) => {
                if (e.target.closest('.read-btn')) {
                    const item = e.target.closest('.inbox-item');
                    if (item) {
                        item.classList.remove('new');
                        e.target.remove();
                    }
                }
            });
        });
    </script>
</body>
</html>